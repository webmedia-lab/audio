<!doctype html>
<html>
  <head>
    <script src="js/extensions.js"></script>
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <center>
      <canvas id="canvas" width="800" height="500" style="background-color:red;"></canvas>
    </center>
  </body>
  <script type="text/javascript">
    window.AudioContext = window.AudioContext || window.webkitAudioContext;

    window.Scale = function(freqs, octaves) {
      self = {}
      self.freqs = []

      for(var octave = octaves[0]; octave <= octaves[1]; octave++){
        freqs.forEach(function(freq){
          self.freqs.push(freq * Math.pow(2, octave))
        });
      }

      self.count = function(){ return self.freqs.length };
      self.get = function(note){ return self.freqs[note] };

      return self;
    }

    window.Harp = function(context, scale){
      var self = {};

      var ctx = context;
      var scale = scale;
      var amplifier = context.createGain();
      var oscillator = context.createOscillator();

      oscillator.connect(amplifier);
      amplifier.connect(ctx.destination);
      oscillator.start(0);

      self.play = function(){
        oscillator.connect(amplifier);
      }

      self.stop = function(){
        oscillator.disconnect();
      }

      self.note = function(note, intensity){
        oscillator.frequency.value = scale.get(note);
        amplifier.gain.value = intensity;
      }


      self.scale = scale

      return self;
    }

    window.addEventListener('load', function(){
      window.context = new AudioContext();
      window.harp_x = Harp(context, new Scale([300,337.5,375,450,500], [-1,0]));
      window.harp_y = Harp(context, new Scale([300,337.5,375,450,500], [-1,0]));

      document.querySelector('#canvas').addEventListener('mousemove', function(event){
        var rect = this.getBoundingClientRect();
        var position = {
          x: event.clientX - rect.left,
          y: event.clientY - rect.top
        }

        var notex = Math.floor(position.x / (this.width / window.harp_x.scale.count()) + 1);

        console.log(notex);

        window.harp_x.note(notex);
      });

    });
  </script>
</html>
